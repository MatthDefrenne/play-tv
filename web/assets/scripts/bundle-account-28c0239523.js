!function(){function e(t,o,r){function n(s,a){if(!o[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=o[s]={exports:{}};t[s][0].call(u.exports,function(e){var o=t[s][1][e];return n(o||e)},u,u.exports,e,t,o,r)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}return e}()({1:[function(e,t,o){t.exports=window.ptv=window.ptv||{}},{}],2:[function(e,t,o){var r=e("./views/initialize/popin");t.exports=new r},{"./views/initialize/popin":11}],3:[function(e,t,o){var r=e("./_global-legacy"),n=e("./views/account/third-parties-facebook"),i=e("./views/account/subscriptions"),s=e("./views/account/profile"),a=e("./views/account/notifications"),c=e("./views/sales/change-payment");r.Collapse.initialize(),new n,new i,new s,new a,new c},{"./_global-legacy":1,"./views/account/notifications":4,"./views/account/profile":7,"./views/account/subscriptions":8,"./views/account/third-parties-facebook":9,"./views/sales/change-payment":12}],4:[function(e,t,o){var r=e("./../base");t.exports=r.extend({el:".ptv-js-AccountNotifications",events:{"submit .ptv-js-AccountNotifications-form":"submitForm"},initialize:function(){this.$alert=this.$(".ptv-js-AccountNotifications-alert"),this.$form=this.$(".ptv-js-AccountNotifications-form").handleInputError()},submitForm:function(e){e.preventDefault();var t=e.currentTarget,o=$(t),r=this,n=o.attr("method"),i=o.attr("action"),s=o.serialize();$.ajax({type:n,url:i,data:s,dataType:"json",success:_.bind(this.formSuccess,r),error:function(e){r.errorCallback(e)}})},formSuccess:function(){var e="Vos notifications ont bien été mises à jour.",t=this;t.$alert.html(e),t.showAlertSuccess()},errorCallback:function(e){var t="Oops, une erreur s'est produite. Veuillez réessayer.",o="undefined"!=typeof e&&"undefined"!=typeof e.responseText?JSON.parse(e.responseText):null,r=this;if(null!==o){var n=document.createDocumentFragment();_.each(o,function(e,t){r.$("*[name="+t+"]").addClass("ptv-Input--error");var o=document.createElement("li");o.innerHTML=e,n.appendChild(o)}),t=n}r.$alert.html(t),r.showAlertError()},showAlertSuccess:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--success")},showAlertError:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--error")},showAlert:function(){this.hideAlert(),this.$alert.addClass("ptv-Alert--active")},hideAlert:function(){this.$alert.removeClass("ptv-Alert--active ptv-Alert--error ptv-Alert--success")}})},{"./../base":10}],5:[function(e,t,o){var r=e("./../base");t.exports=r.extend({el:".ptv-js-AccountProfileInfo",events:{"submit .ptv-js-AccountProfileInfo-form":"submitForm"},initialize:function(){this.$alert=this.$(".ptv-js-AccountProfileInfo-alert"),this.$form=this.$(".ptv-js-AccountProfileInfo-form").handleInputError()},submitForm:function(e){e.preventDefault();var t=e.currentTarget,o=$(t),r=this,n=o.attr("method"),i=o.attr("action"),s=o.serialize();$.ajax({type:n,url:i,data:s,dataType:"json",success:_.bind(this.formSuccess,r),error:function(e){r.errorCallback(e)}})},formSuccess:function(){var e="Votre profil a bien été mis à jour.",t=this;t.$alert.html(e),t.showAlertSuccess()},errorCallback:function(e){var t="Oops, une erreur s'est produite. Veuillez réessayer.",o="undefined"!=typeof e&&"undefined"!=typeof e.responseText?JSON.parse(e.responseText):null,r=this;if(null!==o){var n=document.createDocumentFragment();_.each(o,function(e,t){r.$("*[name="+t+"]").addClass("ptv-Input--error");var o=document.createElement("li");o.innerHTML=e,n.appendChild(o)}),t=n}r.$alert.html(t),r.showAlertError()},showAlertSuccess:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--success")},showAlertError:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--error")},showAlert:function(){this.hideAlert(),this.$alert.addClass("ptv-Alert--active")},hideAlert:function(){this.$alert.removeClass("ptv-Alert--active ptv-Alert--error ptv-Alert--success")}})},{"./../base":10}],6:[function(e,t,o){var r=e("./../base");t.exports=r.extend({el:".ptv-js-AccountProfilePassword",events:{"submit .ptv-js-AccountProfilePassword-form":"submitForm","click .ptv-js-AccountProfilePassword-forgotPasswordLink":"clickForgotPasswordLink"},initialize:function(){this.$alert=this.$(".ptv-js-AccountProfilePassword-alert"),this.$form=this.$(".ptv-js-AccountProfilePassword-form").handleInputError(),this.$forgotPasswordUpdater=this.$("#forgot-password-updater")},clickForgotPasswordLink:function(e){e.preventDefault();var t=this;$.ajax({type:"post",url:"/mot-de-passe-oublie/",dataType:"json"}).fail(function(e){var o="undefined"!=typeof e&&"undefined"!=typeof e.responseText?JSON.parse(e.responseText):null;"undefined"!=typeof o.message&&t.$forgotPasswordUpdater.append(o.message)}).done(function(e){t.$forgotPasswordUpdater.empty(),window.setTimeout(function(){t.$forgotPasswordUpdater.html(e.message)},200)})},submitForm:function(e){e.preventDefault();var t=e.currentTarget,o=$(t),r=this,n=o.attr("method"),i=o.attr("action"),s=o.serialize();$.ajax({type:n,url:i,data:s,dataType:"json",success:_.bind(this.formSuccess,r),error:function(e){r.errorCallback(e)}})},formSuccess:function(){var e="Votre mot de passe a bien été mis à jour.",t=this;t.$alert.html(e),t.showAlertSuccess()},errorCallback:function(e){var t="Oops, une erreur s'est produite. Veuillez réessayer.",o="undefined"!=typeof e&&"undefined"!=typeof e.responseText?JSON.parse(e.responseText):null,r=this;if(null!==o){var n=document.createDocumentFragment();_.each(o,function(e,t){r.$("*[name="+t+"]").addClass("ptv-Input--error");var o=document.createElement("li");o.innerHTML=e,n.appendChild(o)}),t=n}r.$alert.html(t),r.showAlertError()},showAlertSuccess:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--success")},showAlertError:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--error")},showAlert:function(){this.hideAlert(),this.$alert.addClass("ptv-Alert--active")},hideAlert:function(){this.$alert.removeClass("ptv-Alert--active ptv-Alert--error ptv-Alert--success")}})},{"./../base":10}],7:[function(e,t,o){var r=e("./../base"),n=(e("./../../_global-legacy"),e("./profile-info")),i=e("./profile-password"),s=e("./../../_popin");t.exports=r.extend({el:".ptv-js-AccountProfile",events:{"click .ptv-js-AccountProfile-disableLink":"disableAccount"},initialize:function(){new n,new i},disableAccount:function(e){e.preventDefault();var t=this,o=e.currentTarget,r=$(o),n=r.attr("href"),i="Êtes-vous sûr(e) de vouloir supprimer votre compte&nbsp;?",a=r.attr("data-delete-subscriptions"),c=void 0!==a&&!1!==a;c&&(i="Vous êtes encore abonné à nos services via votre opérateur. <br> Avant de pouvoir supprimer votre compte, vous devez vous désabonner."),s.set({mode:"confirm",body:{title:"Suppression de compte",content:i}}),t.listenToOnce(s,"popin:confirm",function(e){!c&&e?Browser.visit(n):s.close()}),s.render()}})},{"./../../_global-legacy":1,"./../../_popin":2,"./../base":10,"./profile-info":5,"./profile-password":6}],8:[function(e,t,o){var r=e("./../base"),n=(e("./../../_global-legacy"),e("./../../_popin"));t.exports=r.extend({el:".ptv-js-AccountProfile",events:{"click .ptv-js-AccountProfile-removeSubscriptionForm button":"removeSubscription"},removeSubscription:function(e){e.preventDefault();var t=this,o=$(e.currentTarget);n.set({mode:"confirm",body:{title:"Suppression d'abonnement",content:"Êtes-vous sûr(e) de vouloir supprimer votre abonnement ?"}}),t.listenToOnce(n,"popin:confirm",function(e){e?o.parents("form").first().trigger("submit"):n.close()}),n.render()}})},{"./../../_global-legacy":1,"./../../_popin":2,"./../base":10}],9:[function(e,t,o){var r=e("./../base");t.exports=r.extend({el:".ptv-js-AccountThirdPartiesFacebook",events:{"click .ptv-js-DialogFacebook":"onDialogFacebook"},initialize:function(){},render:function(){var e=this;return $.ajax({url:"/ui/block-account-facebook-connect/"}).done(function(t){e.$el.html(t)}).fail(function(){}),this},onDialogFacebook:function(e){var t=this,o=function(e){e&&e.authResponse&&"connected"===e.status&&t.handleOauthFacebookConnectFlow(e.authResponse)};FB.login(o,{scope:window.facebookScope.join(",")}),e.preventDefault()},handleOauthFacebookConnectFlow:function(e){var t=this;$.ajax({url:"/oauth/facebook/connect/",type:"post",data:e}).fail(function(){}).done(function(){t.render()})}})},{"./../base":10}],10:[function(e,t,o){var r=window.Backbone;t.exports=r.View.extend({elements:null,constructor:function(){r.View.apply(this,arguments)},storeElements:function(){var e=this.elements;null!==e&&"object"==typeof e&&Object.keys(e).forEach(function(t){this["$"+t]=this.$(e[t]),this[t]=this.$(e[t])[0]},this)},close:function(){this.stopListening(),this.undelegateEvents()}})},{}],11:[function(e,t,o){var r=["success","info","warning","confirm","alert"],n=e("./../base"),i=e("./../../_global-legacy");t.exports=n.extend({el:"#colorbox",template:i.Templates.jst,initialize:function(e){this.set(e)},_reset:function(){this.options={className:"",mode:null,close:!0,body:{}}},set:function(e){this._reset(),_.extend(this.options,e),this._handleMode()},render:function(){var e=this,t="Ok",o="Annuler";e.view={},"alert"!==e.options.mode&&"confirm"!==e.options.mode||(e.view.confirm=e.options.confirmContent||t,e.options.close=!1,e.options.overlayClose=!1),"confirm"===e.options.mode&&(e.view.cancel=e.options.cancelContent||o),e.view.title=e.options.body.title,e.view.content=e.options.body.content,$.colorbox({className:" "+e.options.className,html:e.template.popin.index(e.view),closeButton:e.options.close,overlayClose:e.options.overlayClose,initialWidth:0,initialHeight:0,onComplete:function(){e.$confirm=$(".ptv-js-Popin-confirm"),e.$cancel=$(".ptv-js-Popin-cancel"),e.$confirm.on("click",function(){e.confirmAction()}),e.$cancel.on("click",function(){e.cancelAction()})}})},isActive:function(){return"block"===this.$el.css("display")},confirmAction:function(){this.trigger("popin:confirm",!0)},cancelAction:function(){this.trigger("popin:confirm",!1)},close:function(){this.stopListening(),$.colorbox.close()},_handleMode:function(){var e=this,t=e.options.mode;if(null!==t){if(!_.contains(r,t))throw new Error("Mode available: "+r);e._removeMode(),e.options.className=""!==e.options.className?e.options.className+" ptv-Popin--"+t:"ptv-Popin--"+t}},_removeMode:function(){var e=this;_.each(r,function(t){e.options.className=e.options.className.replace("ptv-Popin--"+t,"")})}})},{"./../../_global-legacy":1,"./../base":10}],12:[function(e,t,o){var r=e("./../base");t.exports=r.extend({el:".ptv-js-Payment",events:{"submit .ptv-js-Payment-form":"submitForm"},initialize:function(){this.$alert=this.$(".ptv-js-Payment-alert"),this.$action=this.$(".ptv-js-Payment-action"),this.$form=this.$(".ptv-js-Payment-form"),this.$paymillToken=this.$form.find(".ptv-js-Payment-paymillToken"),this.ladda=Ladda.create(this.$form.find(".ptv-js-Payment-updateAction").get(0)),this.cardDetector=new BrandDetection},submitForm:function(e){e.preventDefault();var t=this,o=t.verifyPaymill();t.ladda.start(),t.hideAlert(),_.isEmpty(o)?t.createPaymillToken():(t.ladda.stop(),t.formFail(o))},submitFinalForm:function(e){return $.ajax({type:"post",url:"/mon-compte/coordonnees-bancaires/",data:e,dataType:"json"})},createPaymillToken:function(){var e=this,t={amount_int:"0000",currency:"EUR",number:this.$form.find('input[data-name="card-number"]').val(),exp_month:this.$form.find('input[data-name="card-expiry-month"]').val(),exp_year:2e3+parseInt(this.$form.find('input[data-name="card-expiry-year"]').val(),10),cvc:this.$form.find('input[data-name="card-cvc"]').val()};paymill.createToken(t,_.bind(e.paymillResponseHandler,e))},paymillResponseHandler:function(e,t){var o=this;if(e){var r={error:e.apierror};o.formFail(r),o.ladda.stop()}else o.submitFinalForm("token="+t.token).done(function(){o.ladda.stop(),o.formDone()}).fail(function(e){o.ladda.stop(),o.formFail(JSON.parse(e.responseText))})},verifyPaymill:function(){var e={},t=this.$form.find('input[data-name="card-number"]').val();return"visa"!==this.cardDetector.detect(t)&&"carte-bleue"!==this.cardDetector.detect(t)&&"mastercard"!==this.cardDetector.detect(t)&&(e.cardNumber="Votre carte doit être une Carte Bleue, Visa, ou Mastercard."),!1===paymill.validateCardNumber(t)&&(e.cardNumber="Veuillez saisir les 12 chiffres de votre carte bancaire."),!1===paymill.validateCvc(this.$form.find('input[data-name="card-cvc"]').val())&&(e.cardCvc="Veuillez saisir les 3 chiffres au dos de votre carte bancaire."),!1===paymill.validateExpiry(this.$form.find('input[data-name="card-expiry-month"]').val(),2e3+parseInt(this.$form.find('input[data-name="card-expiry-year"]').val(),10))&&(e.cardExpiryDate="La date d'expiration de votre carte bancaire est invalide."),e},formDone:function(){var e=this,t="Vos coordonnées bancaires ont bien été mises à jour.";e.$alert.html(t),e.showAlertSuccess(),e.$action.remove()},formFail:function(e){var t=this,o="Oops, une erreur s'est produite. Veuillez réessayer.";if("undefined"!=typeof e&&_.isObject(e)){var r=document.createDocumentFragment();_.each(e,function(e){var t=document.createElement("li");t.innerHTML=e,r.appendChild(t)}),o=r}t.$alert.html(o),t.showAlertError()},showAlertSuccess:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--success")},showAlertError:function(){this.showAlert(),this.$alert.addClass("ptv-Alert--error")},showAlert:function(){this.hideAlert(),this.$alert.addClass("ptv-Alert--active")},hideAlert:function(){this.$alert.removeClass("ptv-Alert--active ptv-Alert--error ptv-Alert--success")}})},{"./../base":10}]},{},[3]);